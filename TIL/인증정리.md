# 서버 기반 인증 & 토큰 기반 인증



## 서버 기반 인증 시스템

- 서버 측이 사용자들의 정보를 기억

  -> **`세션`** 유지 (메모리, 디스크, DB를 통해 관리)

- 클라이언트의 상태를 계속해서 유지하고 이 정보를 서비스에 이용

  : Sateful 서버

  ex.) 사용자 로그인 -> 사용자 정보 저장 (세션) -> 서비스 제공시 사용

### 문제점

1. **세션**
   
   - 메모리에 저장 -> 사용자 증가 -> RAM 부하
   - DB에 저장 -> DB에 무리
2. **확장성**
   - 사용자 증가 -> 여러 프로세스 돌림 or 컴퓨터 추가
   - 세션 사용 -> 세션을 분산시키는 시스템 설계 -> 매우 어렵고 복잡함
3. **CORS(Cross-Origin Resource Sharing)**

   - **`쿠키`**는 단일 도메인 및 서브 도메인에서만 작동하도록 설계

     -> **`쿠키`**를 여러 도메인에서 관리하는 것은 번거롭다



## 토큰 기반 인증 시스템

- 사용자에게 **토큰을 발급** -> 서버에 요청할 때 헤더에 **토큰을 함께** 보내도록 함 -> **유효성 검사**
- Stateless (상태를 유지하지 않음)

### 좋은점

1. **무상태성(Stateless) & 확장성(Scalability)**

   - 토큰은 클라이언트 측에 저장 -> 서버는 Stateless
   - 클라이언트와 서버의 연결고리 없음 -> 서버를 확장하기에 적합

2. **보안성**

   - 클라이언트가 요청을 보낼 때 쿠키를 전달하지 않음 -> 쿠키 사용에 의한 취약점 사라짐

3. **확장성(Extensibility)**

   - 로그인 정보가 사용되는 분야의 확장

   - 토큰에 선택적인 권한만 부여하여 발급 가능
   - 소셜 계정을 이용하여 다른 웹서비스에 로그인 가능 (OAuth)

4. **여러 플랫폼 및 도메인**

   - CORS 해결

   - 규모가 커지면 여러 디바이스를 호환, 많은 종류의 서비스를 제공

     -> 토큰 사용 -> 어떤 디바이스, 도메인에서도 토큰 유효성 검사 후 요청 처리

     -> *assets 파일은 모두 *CDN에서 제공, 서버는 API만 다루도록 설계 가능

     assets 파일 : ex.) Image, html, css, js 등

     CDN (Contents Delivery Network) : 멀리 떨어져 있는 사용자에게 컨텐츠를 더 빠르게 제공할 수 있는 기술, 느린 응답속도 / 다운로딩 타임을 극복하기 위한 기술



## JWT (Json Web Token)

- 토큰 기반 인증 시스템에서 주로 사용

- Json 포맷을 이용하여 사용자에 대한 속성을 저장하는 Claim 기반의 Web Token

Claim 기반 : 토큰 자체가 정보를 가지고 있음

### JWT 구조

#### 1. Header

1. typ

   : 토큰의 타입을 지정

2. alg

   : 알고리즘 방식을 지정, 서명(Signature) 및 토큰 검증에 사용

#### 2. Payload

1. 등록된 클레임 (Registered Claim)
   - 토큰 정보를 표현하기 위해 이미 정해진 종류의 데이터
2. 공개 클레임 (Public Claim)
   -  사용자 정의 클레임
   - 공개용 정보를 위해 사용
   - URI포멧 이용 (충돌 방지)
3. 비공개 클레임 (Private Claim)
   - 사용자 정의 클레임
   - 서버와 클라이언트 사이에 임의로 지정한 정보 저장

#### 3. Signature

: 토큰을 인코딩하거나 유효성 검증을 할 때 사용하는 고유한 암호화 코드



-----

참고 : https://mangkyu.tistory.com/55